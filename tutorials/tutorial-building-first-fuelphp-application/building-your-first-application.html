<!doctype html>
<html>
<head>
<base href="http://sebastien.drouyer.com/" />
<title>Building your first application</title>
<meta name="robots" content="index,follow">


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

            <link title="static/apps/noviusos_template_bootstrap/vendor/bootstrap/css/skin/Bootstrap.css" rel="stylesheet" type="text/css"
              href="static/apps/noviusos_template_bootstrap/vendor/bootstrap/css/skin/Bootstrap.css">
        <link rel="stylesheet"
          href="static/apps/noviusos_template_bootstrap/vendor/bootstrap/css/social-buttons-3.css">

    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css"
          data-local="static/apps/noviusos_template_bootstrap/vendor/css/jquery-ui.css"/>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"
          data-local="static/apps/noviusos_template_bootstrap/vendor/bootstrap/css/font-awesome.css">

    <!-- Fallback Jquery -->
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript">
        window.jQuery ||
        document.write('<script src="static/apps/noviusos_template_bootstrap/vendor/js/jquery.min.j">\x3C/script>');
    </script>

    <!-- Fallback Jquery UI-->
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script type="text/javascript">
        window.jQuery.ui ||
        document.write('<script src="static/apps/noviusos_template_bootstrap/vendor/js/jquery-ui.min.j">\x3C/script>');
    </script>

    <!-- Fallback Bootstrap.js-->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $.fn.modal || document.write('<script src="static/apps/noviusos_template_bootstrap/vendor/' +
            'bootstrap/js/bootstrap.min.js">\x3C/script>');
    </script>

    <script src="static/apps/noviusos_template_bootstrap/vendor/bootstrap/js/less-1.7.0.min.js"></script>
    <script src="static/apps/noviusos_template_bootstrap/js/script.js"></script>
    <script src="static/plugins/google-code-prettify/run_prettify.js"></script>

    <style>
        @import 'static/website.css';    </style>

<meta name="google-site-verification" content="DWVEKgPu8x-IXuT1UKwTIHa0aAjSyf6Emm7zot0yMtc" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60509693-1', 'auto');
  ga('send', 'pageview');

</script>
</head>


<body id="principal"
      class="customisable title_page"
    >

<div id="content" class="container-fluid">
    <div class="head_content row header-fixed">
    <nav class="navbar navbar-inverse " role="navigation">
        <div class="navbar-header">
            <a class="navbar-brand" id="sitename"
               href="http://sebastien.drouyer.com/"
                ><span id="header-logo-small" class="image_small" style=" display : none"> <img src=""></span><span id="header-title-small" class="title_small" style="">Sébastien Drouyer</span></a>
            <button class="navbar-toggle collapsed right" data-target=".navbar-collapse" data-toggle="collapse"
                    type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="container collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right" id="list-menu">
    <li class="lvl0"><a href="http://sebastien.drouyer.com/projects.html">Projects</a></li><li class="lvl0"><a href="http://sebastien.drouyer.com/tutorials/tutorial-building-first-fuelphp-application.html">Tutorial: building your first FuelPHP application</a></li>    </ul>
            </div>

    </nav>
    <div id="header" class="nav-logo customisable title_header">
        <a href="#" style="display: inline-block;"><span id="header-logo" class="image " style="display : none ;" > <img src=""></span></a>

        <span class="titleonly">
            <a class="link-title" href="#" style="display: inline-block;"><span id="header-title" style="">Sébastien Drouyer</span><br>
            <span id="header-baseline" style=""> </span></a>
        </span>
    </div>
</div>





<div  class="row middle-header-fixed ">
         <div id="middle_content" class=" col-md-12 col-sm-9 col-xs-12" >
            <div id="block-grid" class=" customisable col-md-12 col-sm-12 col-xs-12 main_wysiwyg">
            <div id="grid_content_layout">
            <style>
    .div_layout {
        margin-bottom: 10px;
        text-align: justify;
    }

    .layout {
        padding: 0;
    }
</style>

	 <div class='div_layout col-md-3'
                 style='' data-val=0> </div>
	 <div class='div_layout col-md-6'
                 style='' data-val=3> <div style="margin-top: 10px; margin-bottom: 30px; overflow: hidden;"><a style="float: left;" href="http://sebastien.drouyer.com/tutorials/tutorial-building-first-fuelphp-application/fuelphp-basics.html">« V. FuelPHP basics</a><a style="float: right;" href="http://sebastien.drouyer.com/tutorials/tutorial-building-first-fuelphp-application/deploying-your-application.html">VII. A few notes about deploying your application »</a><br><a href="http://sebastien.drouyer.com/tutorials/tutorial-building-first-fuelphp-application.html">« Table of contents</a></div>
<h1>VI. Building your first application</h1>
<p>Now that we had a quick overview of the FuelPHP framework, let's build our first tiny application.</p>
<p>Suppose that you are a zoo manager and you want to keep track of the monkeys you are looking after. For each monkey, you want to save the following:</p>
<ul>
<li>Its name</li>
<li>If it is still in the zoo</li>
<li>Its height</li>
<li>A description input where you can enter custom information</li>
</ul>
<p>You want a very simple interface with the following five major features:</p>
<ul>
<li>You want to create a new monkey</li>
<li>You want to edit existing ones</li>
<li>You want to list all monkeys</li>
<li>You want to view a detailed file for each monkey</li>
<li>You want to delete monkeys from the system</li>
</ul>
<p>The preceding five major features, very common in computer applications, are part of the <strong>Create, Read, Update and Delete (CRUD)</strong> basic operations. This is a perfect example to use the oil utility to generate a scaffold. Oil will quickly generate for us the controllers, models, views, and migrations to handle our monkeys. All we will have to do, then, is to refine the generated code and adapt it to our needs.</p>
<h2>Database configuration</h2>
<p>As we will store our monkeys into a MySQL database, it is time to configure FuelPHP to use our local database. If you open <code>fuel/app/config/db.php</code>, all you will see is an empty array, but, as we demonstrated it in the <em>FuelPHP basics</em> section, this configuration file is merged to <code>fuel/app/config/ENV/db.php</code>, <code>ENV</code> being the current FuelPHP's environment, which in that case is <code>development</code>.</p>
<p>You should, therefore, open <code>fuel/app/config/development/db.php</code>:</p>
<pre class="prettyprint lang-php">&lt;?php<br>//...<br>return array(<br>&nbsp; 'default' =&gt; array(<br>&nbsp;&nbsp;&nbsp; 'connection' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'dsn' =&gt; 'mysql:host=localhost;dbname=fuel_dev',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'username' =&gt; 'root',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'password' =&gt; 'root',<br>&nbsp;&nbsp;&nbsp; ),<br>&nbsp; ),<br>);</pre>
<p>This is the generated default configuration, which you should adapt to your local configuration, particularly the database name (currently set to <code>fuel_dev</code>), the username, and password. You must create the database of your project manually.</p>
<h2>Scaffolding</h2>
<p>Now that the database configuration is set, we will be able to generate a scaffold. We will use the <code>generate</code> feature of the oil utility.</p>
<p>Open the command-line utility and go to your website root directory. To generate a scaffold for a new model, you will need to enter the following line:</p>
<pre class="prettyprint lang-bash">php oil generate scaffold/crud MODEL ATTR_1:TYPE_1 ATTR_2:TYPE_2 ...</pre>
<p>where:</p>
<ul>
<li><code>MODEL</code> is the model name</li>
<li><code>ATTR_1</code>, <code>ATTR_2</code>… are the model's attribute names</li>
<li><code>TYPE_1</code>, <code>TYPE_2</code>… are attribute types</li>
</ul>
<p>In our case, it should be as follows:</p>
<pre class="prettyprint lang-bash">php oil generate scaffold/crud monkey name:string still_here:bool<br>height:float description:text</pre>
<p>Here we are telling oil to generate a scaffold for the <code>monkey</code> model with the following attributes:</p>
<ul>
<li><code>name</code>: The name of the monkey. Its type is string and the associated MySQL column type will be VARCHAR(255).</li>
<li><code>still_here</code>: Whether or not the monkey is still in the facility. Its type is boolean and the associated MySQL column type will be TINYINT(1).</li>
<li><code>height</code>: Height of the monkey. Its type is float and the associated MySQL column type will be FLOAT.</li>
<li><code>description</code>: Description of the monkey. Its type is text and the associated MySQL column type will be TEXT.</li>
</ul>
<p>You can do much more using the oil generate feature, such as generating models, controllers, migrations, tasks, packages, and so on. We will see some of these later in the book, but you are recommended to take a look at the official documentation at <a href="http://fuelphp.com/docs/packages/oil/generate.html" target="_blank">http://fuelphp.com/docs/packages/oil/generate.html</a> (It can be accessed through the FuelPHP website by navigating to <strong>DOCS | TABLE OF CONTENTS | Oil | Generate</strong>)</p>
<p>When you press <em>Enter</em>, you will see the following lines appear:</p>
<pre class="prettyprint lang-bash">Creating migration: APPPATH/migrations/001_create_monkeys.php<br>Creating model: APPPATH/classes/model/monkey.php<br>Creating controller: APPPATH/classes/controller/monkey.php<br>Creating view: APPPATH/views/monkey/index.php<br>Creating view: APPPATH/views/monkey/view.php<br>Creating view: APPPATH/views/monkey/create.php<br>Creating view: APPPATH/views/monkey/edit.php<br>Creating view: APPPATH/views/monkey/_form.php<br>Creating view: APPPATH/views/template.php</pre>
<p>Oil has generated for us nine files, which are as follows:</p>
<ul>
<li>A migration file, containing all the necessary information to create the model's associated table</li>
<li>The model</li>
<li>A controller</li>
<li>Five view files and a template file</li>
</ul>
<p>We will take a closer look at these files in the next sections.</p>
<div class="bs-callout bs-callout-info">You might have noticed that we used the <code>scaffold/crud</code> command, and, if you read the official documentation, we could have typed only <code>scaffold</code>. This is because two types of scaffold can be generated: <code>scaffold/crud</code>, which uses simple models, and <code>scaffold/orm</code> alias <code>scaffold</code>, which uses the <code>orm</code> models. Since using FuelPHP's native ORM was out of the scope of this chapter, and we didn't have to use complex model features such as relations, we chose to use <code>scaffold/crud</code>.</div>
<h2>Migrating</h2>
<p>One of the generated files was <code>APPPATH/migrations/001_create_monkeys.php</code>. It is a migration file and contains the required information to create our monkey table. Notice that the name is structured as <code>VER_NAME</code>, where <code>VER</code> is the version number and <code>NAME</code> is the name of the migration.</p>
<p>If you execute the following command line:</p>
<pre class="prettyprint lang-bash">php oil refine migrate</pre>
<p>All migration files that have not yet been executed will be executed from the oldest version to the latest version (001, 002, 003, and so on). Once all migration files are executed, oil will display the latest version number.</p>
<p>Once executed, if you take a look at your database, you will observe that not one but two tables have been created:</p>
<ul>
<li><code>monkeys</code>: As expected, a table has been created to handle your monkeys. Notice that the table name is the plural version of the word we typed for generating the scaffold; such a transformation was internally done using the <code>Inflector::pluralize</code> method. The table will contain the specified columns (<code>name</code>, <code>still_here</code>), the <code>id</code> column, and also <code>created_at</code> and <code>updated_at</code>. These columns store the time an object was created and updated, and are added by default each time you generate your models. It is possible to not generate them with the <code>--no-timestamp</code> argument.</li>
<li><code>migration</code>: This table is automatically created the first time you execute migrations. It keeps track of the migrations that were executed. If you look into its content, you will see that it already contains one row; this is the migration you just executed. You can notice that the row does not only indicate the name of the migration, but also a type and a name. This is because migration files can be placed at many places such as modules or packages (see <em>Chapter 3, Building a Blog Application</em>).</li>
</ul>
<div class="bs-callout bs-callout-warning">It is important to note that the <code>migration</code> table is not the only location where FuelPHP keeps track of the already executed migrations. This information is also stored in <code>fuel/app/config/ENV/migrations.php</code>, <code>ENV</code> being FuelPHP's environment. If you decide to edit the <code>migration</code> table, you might want to also edit or delete this file, as it might prevent the execution of your migrations.</div>
<p>The <code>refine migrate</code> feature of oil allows you to have much more control on migrations than simply executing all the new ones. For instance, you can also revert to a previous version using the following command line:</p>
<pre class="prettyprint lang-bash">php oil refine migrate:down</pre>
<p>Or revert to a specified version using the following command line:</p>
<pre class="prettyprint lang-bash">php oil refine migrate --version=3</pre>
<p>Or even choose which modules or packages you want to update using the <code>--modules</code> or <code>--package</code> arguments. To have a complete overview, you are recommended to take a look at the official documentation at <a href="http://fuelphp.com/ docs/general/migrations.html" target="_blank">http://fuelphp.com/ docs/general/migrations.html</a> (It can be accessed through the FuelPHP website by navigating to <strong>DOCS | TABLE OF CONTENTS | FuelPHP | Migrations</strong>)</p>
<p>But how do migration files allow such complex manipulations? Let's open our migration file located at <code>APPPATH/migrations/001_create_monkeys.php</code> to find out. You should see the following:</p>
<pre class="prettyprint lang-php">&lt;?php<br><br>namespace Fuel\Migrations;<br><br>class Create_monkeys<br>{<br>&nbsp;&nbsp;&nbsp; public function up()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \DBUtil::create_table('monkeys', array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'id' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'constraint' =&gt; 11,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'int',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'auto_increment' =&gt; true,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'unsigned' =&gt; true<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'name' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'constraint' =&gt; 255,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'varchar'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'still_here' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'bool'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'height' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'float'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'description' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'text'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'created_at' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'constraint' =&gt; 11,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'int',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'null' =&gt; true<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'updated_at' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'constraint' =&gt; 11,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'int',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'null' =&gt; true<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ), array('id'));<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; public function down()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \DBUtil::drop_table('monkeys');<br>&nbsp;&nbsp;&nbsp; }<br>}</pre>
<p>The file contains a class named <code>Create_monkeys</code> that has the following two methods:</p>
<ul>
<li><code>up</code>: This method defines how to update your data structure. Note that this migration file creates the monkey table using the <code>DBUtil::create_table</code> method, but you could perfectly execute a handmade SQL request to do that. Though migrations are generally used to update your database, you can also use them to update custom data files or old configuration files.
<div class="bs-callout bs-callout-warning">In some cases, if you want to implement your own migrations, you might find the idea of using your application's methods (in models or helpers) attractive. Though it can allow you to limit your code duplication, it is not recommended. This is because, for compatibility reasons, the migration files are intended to stay in your application indefinitely, whereas your application's code can evolve a lot. Therefore, by changing or deleting a method in your application, you might unexpectedly break some migration files (that use this method) without even noticing it, making the future installation of your application complicated.</div>
</li>
<li><code>down</code>: This method defines how to cancel all changes that were made by the <code>up</code> method. Suppose you realize that the feature was a mistake and you want to revert to an older version: this is when this method will be executed. In our case, the method simply deletes the monkey table.
<div class="bs-callout bs-callout-warning">If the information contained in the table is important, it might be a good idea to instead move the table, for instance, to an archive database. A human mistake could have disastrous consequences otherwise.</div>
</li>
</ul>
<p>The migration files are a powerful tool and their usefulness increase tenfold as the number of instances and the number of developers working on the same project rise. Using them from scratch is always a good decision.</p>
<h2>Using your application</h2>
<p>Now that we have generated the code and migrated the database, our application is ready to be used. You might have noticed during the generation that a controller was created at <code>APPPATH/classes/controller/monkey.php</code> and that the route configuration file was not changed, meaning that the controller must be accessible through the default URL.</p>
<p>Let's request, then, the URL <a href="http://my.app/monkey" target="_blank">http://my.app/monkey</a>.</p>
<p>As you can notice, this web page is intended to display the list of all monkeys, but since none have been added, the list is empty:</p>
<p><img class="nosMedia" style="display: block; margin-left: auto; margin-right: auto;" title="Monkeys List" src="media/fuelphp-book/monkeys-list.png?t=2015-03-23+00%3A16%3A52" alt="Monkeys List" data-media="{&quot;title&quot;:&quot;Monkeys List&quot;,&quot;ext&quot;:&quot;png&quot;,&quot;file&quot;:&quot;monkeys-list&quot;,&quot;path&quot;:&quot;http://sebastien.drouyer.com/media/fuelphp-book/monkeys-list.png?t=2015-03-23+00%3A16%3A52&quot;,&quot;path_folder&quot;:&quot;media/fuelphp-book&quot;,&quot;media_path&quot;:&quot;/fuelphp-book/monkeys-list.png&quot;,&quot;image&quot;:true,&quot;thumbnail&quot;:&quot;http://sebastien.drouyer.com/cache/media/fuelphp-book/monkeys-list/s,64,64-52c7bc.png?t=2015-03-23+00%3A16%3A52&quot;,&quot;height&quot;:&quot;338&quot;,&quot;width&quot;:&quot;1185&quot;,&quot;filesize&quot;:&quot;28.5 KB&quot;,&quot;dimensions&quot;:&quot;1185 × 338&quot;,&quot;thumbnailAlternate&quot;:&quot;&quot;,&quot;icon&quot;:&quot;static/apps/noviusos_media/icons/16/png.png&quot;,&quot;actions&quot;:[],&quot;_id&quot;:&quot;59&quot;,&quot;_model&quot;:&quot;Nos\\Media\\Model_Media&quot;,&quot;_title&quot;:&quot;Monkeys List&quot;}" height="143" width="500"></p>
<p>Then, let's add a new monkey by clicking on the <strong>Add new Monkey</strong> button. The following web page should appear:</p>
<p><img class="nosMedia" style="display: block; margin-left: auto; margin-right: auto;" title="Monkeys Add" src="media/fuelphp-book/monkeys-add.png?t=2015-03-23+00%3A18%3A11" alt="Monkeys Add" data-media="{&quot;title&quot;:&quot;Monkeys Add&quot;,&quot;ext&quot;:&quot;png&quot;,&quot;file&quot;:&quot;monkeys-add&quot;,&quot;path&quot;:&quot;http://sebastien.drouyer.com/media/fuelphp-book/monkeys-add.png?t=2015-03-23+00%3A18%3A11&quot;,&quot;path_folder&quot;:&quot;media/fuelphp-book&quot;,&quot;media_path&quot;:&quot;/fuelphp-book/monkeys-add.png&quot;,&quot;image&quot;:true,&quot;thumbnail&quot;:&quot;http://sebastien.drouyer.com/cache/media/fuelphp-book/monkeys-add/s,64,64-f7d727.png?t=2015-03-23+00%3A18%3A11&quot;,&quot;height&quot;:&quot;753&quot;,&quot;width&quot;:&quot;1188&quot;,&quot;filesize&quot;:&quot;51.8 KB&quot;,&quot;dimensions&quot;:&quot;1188 × 753&quot;,&quot;thumbnailAlternate&quot;:&quot;&quot;,&quot;icon&quot;:&quot;static/apps/noviusos_media/icons/16/png.png&quot;,&quot;actions&quot;:[],&quot;_id&quot;:&quot;60&quot;,&quot;_model&quot;:&quot;Nos\\Media\\Model_Media&quot;,&quot;_title&quot;:&quot;Monkeys Add&quot;}" height="317" width="500"></p>
<p>You can enter your monkey's information here. There are, however, several inconsistencies:</p>
<ul>
<li>All fields are required, meaning that you can't leave any field empty, otherwise errors will be triggered preventing you from adding the monkey. This is not what we might want for the description field.</li>
<li>Though you can enter anything you want in the <strong>Height</strong> field without triggering any error, if you enter anything other than a float, it will be replaced by 0. We might want to trigger an error in such a case.</li>
<li><strong>Still here</strong> can only have two values: 0 or 1 (false or true). Though the type of the associated database column is correct, the generated form uses a standard input where we might want a checkbox.</li>
</ul>
<p>The form is certainly not perfect, but it is a great start. All we will have to do is refine the code a little bit.</p>
<p>Once you have added several monkeys, you can again take a look at the listing page as follows:</p>
<p><img class="nosMedia" style="display: block; margin-left: auto; margin-right: auto;" title="Monkeys List After" src="media/fuelphp-book/monkeys-list-after.png?t=2015-03-23+00%3A20%3A18" alt="Monkeys List After" data-media="{&quot;title&quot;:&quot;Monkeys List After&quot;,&quot;ext&quot;:&quot;png&quot;,&quot;file&quot;:&quot;monkeys-list-after&quot;,&quot;path&quot;:&quot;http://sebastien.drouyer.com/media/fuelphp-book/monkeys-list-after.png?t=2015-03-23+00%3A20%3A18&quot;,&quot;path_folder&quot;:&quot;media/fuelphp-book&quot;,&quot;media_path&quot;:&quot;/fuelphp-book/monkeys-list-after.png&quot;,&quot;image&quot;:true,&quot;thumbnail&quot;:&quot;http://sebastien.drouyer.com/cache/media/fuelphp-book/monkeys-list-after/s,64,64-b3ce81.png?t=2015-03-23+00%3A20%3A18&quot;,&quot;height&quot;:&quot;377&quot;,&quot;width&quot;:&quot;1169&quot;,&quot;filesize&quot;:&quot;42.5 KB&quot;,&quot;dimensions&quot;:&quot;1169 × 377&quot;,&quot;thumbnailAlternate&quot;:&quot;&quot;,&quot;icon&quot;:&quot;static/apps/noviusos_media/icons/16/png.png&quot;,&quot;actions&quot;:[],&quot;_id&quot;:&quot;61&quot;,&quot;_model&quot;:&quot;Nos\\Media\\Model_Media&quot;,&quot;_title&quot;:&quot;Monkeys List After&quot;}" height="161" width="500"></p>
<p>Again, this is a great start, though we might want to refine it a little bit: display <strong>Yes</strong> and <strong>No</strong> instead of <strong>1</strong> and <strong>0</strong>, respectively, for the <strong>Still here</strong> column, and remove the <strong>Description</strong> column because there might be too much text to display.</p>
<p>Each item on the list has three associated actions: <strong>View</strong>, <strong>Edit</strong>, and <strong>Delete</strong>.</p>
<p>Let's first click on <strong>View</strong>:</p>
<p style="text-align: center;"><img class="nosMedia" title="Monkey View" src="media/fuelphp-book/monkey-view.png?t=2015-03-23+00%3A22%3A37" alt="Monkey View" data-media="{&quot;title&quot;:&quot;Monkey View&quot;,&quot;ext&quot;:&quot;png&quot;,&quot;file&quot;:&quot;monkey-view&quot;,&quot;path&quot;:&quot;http://sebastien.drouyer.com/media/fuelphp-book/monkey-view.png?t=2015-03-23+00%3A22%3A37&quot;,&quot;path_folder&quot;:&quot;media/fuelphp-book&quot;,&quot;media_path&quot;:&quot;/fuelphp-book/monkey-view.png&quot;,&quot;image&quot;:true,&quot;thumbnail&quot;:&quot;http://sebastien.drouyer.com/cache/media/fuelphp-book/monkey-view/s,64,64-a4c7ef.png?t=2015-03-23+00%3A22%3A37&quot;,&quot;height&quot;:&quot;338&quot;,&quot;width&quot;:&quot;1162&quot;,&quot;filesize&quot;:&quot;31.6 KB&quot;,&quot;dimensions&quot;:&quot;1162 × 338&quot;,&quot;thumbnailAlternate&quot;:&quot;&quot;,&quot;icon&quot;:&quot;static/apps/noviusos_media/icons/16/png.png&quot;,&quot;actions&quot;:[],&quot;_id&quot;:&quot;62&quot;,&quot;_model&quot;:&quot;Nos\\Media\\Model_Media&quot;,&quot;_title&quot;:&quot;Monkey View&quot;}" height="145" width="500"></p>
<p style="text-align: justify;">Again this is a great start, though we will also refine this web page.</p>
<p style="text-align: justify;">You can return back to the listing by clicking on <strong>Back</strong> or edit the monkey by clicking on <strong>Edit</strong>. Accessed from either the listing page or the view page, it will display the same form as when creating a new monkey, except that the form will be prefilled of course.</p>
<p style="text-align: justify;">Finally, if you click on Delete, a confirmation box will appear to prevent any miss clicking:</p>
<p><img class="nosMedia" style="display: block; margin-left: auto; margin-right: auto;" title="Monkey Delete" src="media/fuelphp-book/monkey-delete.png?t=2015-03-23+00%3A24%3A11" alt="Monkey Delete" data-media="{&quot;title&quot;:&quot;Monkey Delete&quot;,&quot;ext&quot;:&quot;png&quot;,&quot;file&quot;:&quot;monkey-delete&quot;,&quot;path&quot;:&quot;http://sebastien.drouyer.com/media/fuelphp-book/monkey-delete.png?t=2015-03-23+00%3A24%3A11&quot;,&quot;path_folder&quot;:&quot;media/fuelphp-book&quot;,&quot;media_path&quot;:&quot;/fuelphp-book/monkey-delete.png&quot;,&quot;image&quot;:true,&quot;thumbnail&quot;:&quot;http://sebastien.drouyer.com/cache/media/fuelphp-book/monkey-delete/s,64,64-39abbc.png?t=2015-03-23+00%3A24%3A11&quot;,&quot;height&quot;:&quot;419&quot;,&quot;width&quot;:&quot;1173&quot;,&quot;filesize&quot;:&quot;72.5 KB&quot;,&quot;dimensions&quot;:&quot;1173 × 419&quot;,&quot;thumbnailAlternate&quot;:&quot;&quot;,&quot;icon&quot;:&quot;static/apps/noviusos_media/icons/16/png.png&quot;,&quot;actions&quot;:[],&quot;_id&quot;:&quot;63&quot;,&quot;_model&quot;:&quot;Nos\\Media\\Model_Media&quot;,&quot;_title&quot;:&quot;Monkey Delete&quot;}" height="179" width="500"></p>
<h2 style="text-align: justify;">Refining the application</h2>
<p style="text-align: justify;">Now that we took a look at our interface, let's refine our application so that it becomes more user-friendly. In this section, we will explore the files that have been generated by oil and try to adapt them to our needs.</p>
<h3 style="text-align: justify;">Refining the monkey listing</h3>
<p>During the previous section, two small issues bothered us for the monkey's listing:</p>
<ul>
<li>We wanted more explicit values than 0 and 1 for the <code>Still here</code> column</li>
<li>We wanted to remove the <code>Description</code> column</li>
</ul>
<p>We know that the list appears when requesting the following URL:</p>
<p><a href="http://my.app/monkey" target="_blank">http://my.app/monkey</a></p>
<p>You have probably noticed that in this URL we indicated a controller, but no action. It is important to know that, by default and without any routing configuration involved, this URL is equivalent to <a href="http://my.app/monkey/index" target="_blank">http://my.app/monkey/index</a>.</p>
<p>So, in fact, we are calling the <code>index</code> action of the <code>monkey</code> controller. If we open the generated controller at <code>APPPATH/classes/controller/monkey.php</code>, we will read the following:</p>
<pre class="prettyprint lang-php">&lt;?php<br>class Controller_Monkey extends Controller_Template{<br>&nbsp;&nbsp;&nbsp; //...<br>}</pre>
<p>First, you can notice that <code>Controller_Monkey</code> extends <code>Controller_Template</code> instead of <code>Controller</code>, as we saw before in <code>Controller_Welcome</code>. <code>Controller_Template</code> is an extension of <code>Controller</code> that adds template support. The idea is that most of the time your web pages will have the same layout: the headers, footers, and menus generally stay the same, regardless of the web pages you are in. Templates allow you to achieve this by limiting the code duplication.</p>
<p>By default, <code>Controller_Template</code> is associated with the <code>APPPATH/views/ template.php</code> template that was generated by oil. If you open this file, you will see that it generates the HTML code around the page content. You will also probably notice that it prints the <code>$title</code> and <code>$content</code> variables. We will find out how to set their values by exploring the <code>index</code> action. If you go back to the <strong>Monkey</strong> controller, the <code>action_index</code> method should contain the following:</p>
<pre class="prettyprint lang-php">public function action_index()<br>{<br>&nbsp;&nbsp;&nbsp; $data['monkeys'] = Model_Monkey::find_all();<br>&nbsp;&nbsp;&nbsp; $this-&gt;template-&gt;title = "Monkeys";<br>&nbsp;&nbsp;&nbsp; $this-&gt;template-&gt;content = View::forge('monkey/index', $data);<br>}</pre>
<p>The first line stores all the monkeys' instances into the <code>$data['monkeys']</code> variable. In a general manner, <code>MODEL::find_all()</code> returns all a model's instances, but it is definitely not the only method that retrieve instances. These methods will be discussed more thoroughly in <em>Chapter 2, Building a To-do List Application</em>.</p>
<p>The second and third lines set the <code>$title</code> and <code>$content</code> variables displayed in the template file. If you change the second line by <code>$this-&gt;template-&gt;title = "My monkeys";</code> and then refresh the web page, you will see that its title has changed accordingly.</p>
<p>The third line sets the <code>$content</code> variable to a view instance that, from what we have observed in the previous sections, executes the view file located at <code>APPPATH/views/monkey/index.php</code> with the <code>$monkey</code> variable set to all monkeys' instances. Let's open this view file. You should see the following:</p>
<pre class="prettyprint lang-php">&lt;h2&gt;Listing Monkeys&lt;/h2&gt;<br>&lt;br&gt;<br>&lt;?php if ($monkeys): ?&gt;<br>&lt;table class="table table-striped"&gt;<br>&nbsp;&nbsp;&nbsp; &lt;thead&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;Name&lt;/th&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;Still here&lt;/th&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;Height&lt;/th&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;Description&lt;/th&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;&lt;/th&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/thead&gt;<br>&nbsp;&nbsp;&nbsp; &lt;tbody&gt;<br>&nbsp;&nbsp;&nbsp; &lt;?php foreach ($monkeys as $item): ?&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;?php echo $item-&gt;name; ?&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;?php echo $item-&gt;still_here; ?&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;?php echo $item-&gt;height; ?&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;?php echo $item-&gt;description; ?&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php /* Action buttons */ ?&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br>&lt;?php endforeach; ?&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/tbody&gt;<br>&lt;/table&gt;<br>&lt;?php else: ?&gt;<br>&lt;p&gt;No Monkeys.&lt;/p&gt;<br>&lt;?php endif; ?&gt;&lt;p&gt;<br>&lt;?php /* Add new Monkey button */ ?&gt;<br>&lt;/p&gt;</pre>
<p>We have found where the table is displayed, so it is time to make our changes.</p>
<p>First, remove the <code>Description</code> column by removing the following:</p>
<pre class="prettyprint lang-php">&lt;th&gt;Description&lt;/th&gt;</pre>
<p>and</p>
<pre class="prettyprint lang-php">&lt;td&gt;&lt;?php echo $item-&gt;description; ?&gt;&lt;/td&gt;</pre>
<p>Then, let's refine how the <code>Still here</code> attribute is displayed by replacing the following:</p>
<pre class="prettyprint lang-php">&lt;td&gt;&lt;?php echo $item-&gt;still_here; ?&gt;&lt;/td&gt;</pre>
<p>by</p>
<pre class="prettyprint lang-php">&lt;td&gt;&lt;?php echo $item-&gt;still_here ? 'Yes' : 'No'; ?&gt;&lt;/td&gt;</pre>
<p>The <strong>Still here</strong> column should now display <strong>Yes</strong> and <strong>No</strong> instead of <strong>1</strong> and <strong>0</strong>, respectively.</p>
<h3>Refining the monkey detailed view</h3>
<p>On the list, when clicking on an item's <strong>View</strong> link, a detailed view of the monkey appears. We would like to change two details here:</p>
<ul>
<li>As in the previous section, display more explicit values for the<br><strong>Still here</strong> attribute</li>
<li>Currently, if you save a monkey with a multiline description, it is displayed on one line only</li>
</ul>
<p>First, if you are on a detailed view page, you can notice that the URL is similar to <a href="http://my.app/monkey/view/1" target="_blank">http://my.app/monkey/view/1</a></p>
<p>This means we are calling the <code>view</code> action of the <code>monkey</code> controller with the first and only parameter set to 1. The <code>view</code> action is quite similar to the <code>index</code> action, as you can see in the following snippet:</p>
<pre class="prettyprint lang-php">public function action_view($id = null)<br>{<br>&nbsp;&nbsp;&nbsp; is_null($id) and Response::redirect('monkey');<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; $data['monkey'] = Model_Monkey::find_by_pk($id);<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; $this-&gt;template-&gt;title = "Monkey";<br>&nbsp;&nbsp;&nbsp; $this-&gt;template-&gt;content = View::forge('monkey/view', $data);<br>}</pre>
<p>The first line simply checks if the parameter of the action (associated to the <code>$id</code> variable) is actually set, and otherwise redirects the user (using the <code>Response::redirect</code> method) to the listing page.</p>
<p>The second line stores the monkey with ID <code>$id</code> into the <code>$data['monkey']</code> variable. The <code>find_by_pk</code> (pk for primary key) method of a model finds one of its instances by its primary key. As we explained earlier, models' methods will be discussed more thoroughly in <em>Chapter 2, Building a To-do List Application</em>.</p>
<div class="bs-callout bs-callout-info">Just to be perfectly clear, requesting the URL <a href="http://my.app/monkey/view/ID" target="_blank">http://my.app/monkey/view/ID</a> will load the monkey instance with id = ID.</div>
<p>The third and fourth lines, as in the previous section, set the template variables. The template content is set to the view located at <code>APPPATH/views/monkey/view.php</code>.</p>
<pre class="prettyprint lang-php">&lt;h2&gt;Viewing #&lt;?php echo $monkey-&gt;id; ?&gt;&lt;/h2&gt;<br><br>&lt;p&gt;<br>&nbsp;&nbsp;&nbsp; &lt;strong&gt;Name:&lt;/strong&gt;<br>&nbsp;&nbsp;&nbsp; &lt;?php echo $monkey-&gt;name; ?&gt;&lt;/p&gt;<br>&lt;p&gt;<br>&nbsp;&nbsp;&nbsp; &lt;strong&gt;Still here:&lt;/strong&gt;<br>&nbsp;&nbsp;&nbsp; &lt;?php echo $monkey-&gt;still_here; ?&gt;&lt;/p&gt;<br>&lt;p&gt;<br>&nbsp;&nbsp;&nbsp; &lt;strong&gt;Height:&lt;/strong&gt;<br>&nbsp;&nbsp;&nbsp; &lt;?php echo $monkey-&gt;height; ?&gt;&lt;/p&gt;<br>&lt;p&gt;<br>&nbsp;&nbsp;&nbsp; &lt;strong&gt;Description:&lt;/strong&gt;<br>&nbsp;&nbsp;&nbsp; &lt;?php echo $monkey-&gt;description; ?&gt;&lt;/p&gt;<br><br>&lt;?php /* Edit button */ ?&gt; |<br>&lt;?php /* Back button */ ?&gt;</pre>
<p>It is time to do some changes.</p>
<p>Replace:</p>
<pre class="prettyprint lang-php">&lt;?php echo $monkey-&gt;still_here; ?&gt;</pre>
<p>By:</p>
<pre class="prettyprint lang-php">&lt;?php echo $monkey-&gt;still_here ? 'Yes' : 'No'; ?&gt;</pre>
<p>And replace:</p>
<pre class="prettyprint lang-php">&lt;?php echo $monkey-&gt;description; ?&gt;</pre>
<p>By:</p>
<pre class="prettyprint lang-php">&lt;div&gt;&lt;?php echo nl2br($monkey-&gt;description); ?&gt;&lt;/div&gt;</pre>
<h3>Allowing an empty description</h3>
<p>One of the issues we pointed out previously, is that the description field is required, though we want to be able to enter an empty value.</p>
<p>First, open your browser and request the following URL:</p>
<p><a href="http://my.app/monkey" target="_blank">http://my.app/monkey</a></p>
<p>Click on the <strong>Add a new Monkey</strong> button, and you can see you are redirected to <a href="http://my.app/monkey/create" target="_blank">http://my.app/monkey/create</a></p>
<p>If you take a look at the page source, you will find that the form's <code>action</code> attribute is actually the same URL:</p>
<pre class="prettyprint lang-php">&lt;form class="form-horizontal" action="http://my.app/monkey/create"<br>accept-charset="utf-8" method="post"&gt;</pre>
<p>It means that whether we are opening the monkey's creation form or submitting it, we will always call the <code>create</code> action of the <code>monkey</code> controller. We should then read how this action is implemented:</p>
<pre class="prettyprint lang-php">public function action_create()<br>{<br>&nbsp;&nbsp;&nbsp; if (Input::method() == 'POST')<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $val = Model_Monkey::validate('create');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($val-&gt;run())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Saves the model (out of this chapter scope)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session::set_flash('error', $val-&gt;error());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; $this-&gt;template-&gt;title = "Monkeys";<br>&nbsp;&nbsp;&nbsp; $this-&gt;template-&gt;content = View::forge('monkey/create');<br>&nbsp;&nbsp; &nbsp;<br>}</pre>
<p>As you can notice, the action is able to know whether or not it is accessed through a POST request by using <code>Input::method()</code>. You are recommended to take a look at the official documentation of the <code>Input</code> class at <a href="http://fuelphp.com/docs/classes/input.html" target="_blank">http://fuelphp.com/docs/classes/input.html</a> (It can be accessed through the FuelPHP website by navigating to <strong>DOCS | TABLE OF CONTENTS | Core | Input</strong>)</p>
<p><code>Model_Monkey::validate('create')</code> returns an object that seems to define whether or not the object can be saved (depending on what <code>$val-&gt;run()</code> returns). This is a method from the <strong>Monkey</strong> model, so we should look into it. Open <code>APPPATH/classes/model/monkey.php</code>:</p>
<pre class="prettyprint lang-php">&lt;?php<br>class Model_Monkey extends Model_Crud<br>{<br>&nbsp;&nbsp;&nbsp; protected static $_table_name = 'monkeys';<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; public static function validate($factory)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $val = Validation::forge($factory);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $val-&gt;add_field('name', 'Name', 'required|max_length[255]');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $val-&gt;add_field('still_here', 'Still Here', 'required');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $val-&gt;add_field('height', 'Height', 'required');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $val-&gt;add_field('description', 'Description', 'required');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $val;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp; &nbsp;<br>}</pre>
<p>The file contains the <code>Model_Monkey</code> class that extends <code>Model_Crud</code> and allows us to handle the monkey instances.</p>
<p>First, you can notice the <code>$_table_name</code> static attribute that defines the table name where the objects are saved (here, all our monkeys are saved into the <code>monkeys</code> table).</p>
<p>And then there is the <code>validate</code> static method we are looking for. It returns a <code>Validation</code> object, that in our case will check that:</p>
<ul>
<li>The <code>name</code> attribute is not empty and its length is less than 255 characters</li>
<li><code>still_here</code>, <code>height</code>, and <code>description</code> are not empty</li>
</ul>
<p>For more detail about this class, you are recommended to read the official documentation at <a href="http://fuelphp.com/docs/classes/validation/validation.html" target="_blank">http://fuelphp.com/docs/classes/validation/validation.html</a> (It can be accessed through the FuelPHP website by navigating to <strong>DOCS | TABLE OF CONTENTS | Core | Validation | Introduction</strong>)</p>
<p>In our case, simply comment or remove the following line:</p>
<pre class="prettyprint lang-php">$val-&gt;add_field('description', 'Description', 'required');</pre>
<div class="bs-callout bs-callout-info">You might have read <code>Session::set_flash</code> several times in the <code>Controller_Monkey</code> controller and <code>Session::get_flash</code> several times in the template. Session flash variables have a very limited life span and are generally used to store temporary information, such as notices or errors displayed to the user.</div>
<h3>Checking whether the height is a float</h3>
<p>It is now easy to check if the height is a float. As we know that monkeys are generally not taller than 4 feet, we can even add a numerical constraint. In the <code>validate</code> method of <code>Model_Monkey</code>, replace the following line:</p>
<pre class="prettyprint lang-php">$val-&gt;add_field('height', 'Height', 'required');</pre>
<p>by</p>
<pre class="prettyprint lang-php">$val-&gt;add_field(<br>&nbsp;&nbsp;&nbsp; 'height',<br>&nbsp;&nbsp;&nbsp; 'Height',<br>&nbsp;&nbsp;&nbsp; 'required|numeric_between[0,6]'<br>);</pre>
<h3>Using a checkbox instead of an input for the still_here attribute</h3>
<p>This change will be a bit more complex. First, still in the <code>validate</code> method of <code>Model_Monkey</code>, remove the following line as we won't need this validation:</p>
<pre class="prettyprint lang-php">$val-&gt;add_field('still_here', 'Still Here', 'required');</pre>
<p>Now, if you go back to our <code>create</code> action in <code>Controller_Monkey</code> (located at <code>APPPATH/classes/controller/monkey.php</code>), you will see that the template content is set to the view located at <code>APPPATH/views/monkey/create.php</code>. If you look at the file content, it is pretty simple:</p>
<pre class="prettyprint lang-php">&lt;h2&gt;New Monkey&lt;/h2&gt;<br>&lt;br&gt;<br><br>&lt;?php echo render('monkey/_form'); ?&gt;<br><br>&lt;p&gt;&lt;?php echo Html::anchor('monkey', 'Back'); ?&gt;&lt;/p&gt;</pre>
<p>For your information, the <code>render</code> method is an alias of <code>View::render</code>, and in this case equivalent to <code>View::forge</code>. This illustrates that it is possible to render views inside other views. It can be convenient to prevent code repetition; the view located at <code>APPPATH/views/monkey/edit.php</code> also renders the same view (<code>monkey/_form</code>), and this makes sense since the forms displayed are exactly the same, whether you create a new monkey or edit an existing one.</p>
<p>Since we want to edit the form to replace the <code>still_here</code> input by a checkbox, open the view located at <code>APPPATH/views/monkey/_form.php</code> and replace the following lines:</p>
<pre class="prettyprint lang-php">&lt;?php<br>echo Form::input(<br>&nbsp;&nbsp;&nbsp; 'still_here',<br>&nbsp;&nbsp;&nbsp; Input::post(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'still_here',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isset($monkey) ? $monkey-&gt;still_here : ''<br>&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'class' =&gt; 'col-md-4 form-control',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'placeholder' =&gt; 'Still here'<br>&nbsp;&nbsp;&nbsp; )<br>);<br>?&gt;</pre>
<p>By</p>
<pre class="prettyprint lang-php">&lt;?php<br>echo Form::checkbox(<br>&nbsp;&nbsp;&nbsp; 'still_here',<br>&nbsp;&nbsp;&nbsp; 1,<br>&nbsp;&nbsp;&nbsp; Input::post(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'still_here',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isset($monkey) ? $monkey-&gt;still_here : true<br>&nbsp;&nbsp;&nbsp; )<br>);<br>?&gt;</pre>
<div class="bs-callout bs-callout-info">In the code above, the first parameter is the name attribute of the checkbox. The second parameter is the value attribute of the checkbox. The third parameter determines whether the checkbox is checked or not. You can notice that, when we create a new monkey (and therefore no monkey is set), the checkbox will be checked by default. You are recommended to read the official documentation for more information about the <code>Form</code> class at <a href="http://fuelphp.com/docs/classes/form.html" target="_blank">http://fuelphp.com/docs/classes/form.html</a> (It can be accessed through the FuelPHP website by navigating to <strong>DOCS | TABLE OF CONTENTS | Core | Form</strong>)</div>
<p>Finally, you are probably aware that the <code>still_here</code> POST attribute won't be defined if the checkbox is unchecked when submitting the form. Thus, we need to define a default value when retrieving the <code>still_here</code> POST attribute, not only in the <code>create</code> action but also in the <code>edit</code> action. In both the methods, replace the following:</p>
<pre class="prettyprint lang-php">Input::post('still_here')</pre>
<p>by</p>
<pre class="prettyprint lang-php">Input::post('still_here', 0)</pre>
<div class="bs-callout bs-callout-warning">Our solution works, but, in most cases, hard-coding a default value is not a good idea. When indicating a default value, for a request parameter or a configuration item, the best is to define this value inside a centralized configuration file and load it from there. Always avoid hard-coding constants, even for default values.</div>
<h3>Setting custom routes</h3>
<p>Last but not least, we don't want to display FuelPHP's welcome screen when requesting the root URL, but instead the monkeys' listing. For doing that we will have to change the routes' configuration file located at <code>APPPATH/config/routes.php</code>.</p>
<p>Replace:</p>
<pre class="prettyprint lang-php">'_root_' =&gt; 'welcome/index',</pre>
<p>By:</p>
<pre class="prettyprint lang-php">'_root_' =&gt; 'monkey/index',</pre>
<p>When requesting:</p>
<p><a href="http://my.app/" target="_blank">http://my.app/</a></p>
<p>You should now see your monkey listing.</p>
<h3>Removing useless routes and files</h3>
<p>Now that our project is working as intended, it might be a good idea to clean it:</p>
<ul>
<li>Remove <code>APPPATH/classes/controller/welcome.php</code> as we don't need this controller anymore</li>
<li>Remove the <code>APPPATH/classes/presenter</code> folder</li>
<li>Remove the <code>APPPATH/views/welcome</code> folder</li>
<li>And remove the <code>_404_</code>, <code>hello(/:name)?</code>, <code>my/welcome/page</code> keys from the routes' configuration file located at <code>APPPATH/config/routes.php</code>.</li>
</ul>
<div style="margin-top: 30px; margin-bottom: 50px; overflow: hidden;"><a style="float: left;" href="http://sebastien.drouyer.com/tutorials/tutorial-building-first-fuelphp-application/fuelphp-basics.html">« V. FuelPHP basics</a><a style="float: right;" href="http://sebastien.drouyer.com/tutorials/tutorial-building-first-fuelphp-application/deploying-your-application.html">VII. A few notes about deploying your application »</a><br><a href="http://sebastien.drouyer.com/tutorials/tutorial-building-first-fuelphp-application.html">« Table of contents</a></div>
<blockquote><em>This tutorial contains the first chapter of my book <strong>FuelPHP application development blueprints</strong>. I released this chapter freely so that you can have an idea of what the book looks like and get a first overview of the FuelPHP framework. Don't hesitate to contact me if you have any question. You can buy the book on the <a href="https://www.packtpub.com/web-development/fuelphp-application-development-blueprints" target="_blank">Packt Publishing website</a>, on <a href="http://www.amazon.com/FuelPHP-Application-Development-Blueprints-Sebastien/dp/1783985402/" target="_blank">Amazon</a>, on <a href="http://www.barnesandnoble.com/w/fuelphp-application-development-blueprints-sebastien-drouyer/1121167519" target="_blank">BN.com</a> and most internet book retailers.</em></blockquote></div>
	 <div class='div_layout col-md-3'
                 style='' data-val=0> </div>            </div>
        </div>
        <br>
     </div>
    </div>
<div id="footer" class="row footer customisable middle-header-fixed">
    <div class="footer_menu">
<ul class="nav nav-pills nav-justified" style="text-align: left">    </div>

    <div class="footer_text"><p>© Sébastien Drouyer. Except specified otherwise, all this website content is under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 3.0</a>.</p>    </div>
</div>
</div>
</body>
</html>